---
title: "plot_bbs_prot"
output: html_document
date: "2023-12-11"
---

```{r, include = FALSE, message = FALSE}
## Install packages if not already installed
install.packages(c("tidyverse", 
                 "reshape2", 
                 "ggpubr", 
                 "stringer",
                 "plyr"))

```

1. Load libraries and set working directory:

```{r, setup, include = FALSE}
## Load libraries and set global working directory
library(ggplot2)
library(ggtext)
library(tidyverse)
library(reshape2)
library(ggpubr)
library(stringr)
library(plyr)

knitr::opts_knit$set(root.dir = '/home/ina/bbs_project')
```

2.1 Load already prepared data and skip step 2.2 and 3:

The table created in this script and used for the plots can be saved at the end. If only changes with the plots are made, the table can be loaded here and the next steps can be skipped

```{r, include = FALSE}
data_sub <- read.table(file = "data/bbs_results_plot.txt", header = TRUE)
```

2.2 Load data and prepare functions:

```{r, message = FALSE}
## Read in species list:
species_list <- read.table(file = "data/bbs_list2.txt",
                           header = FALSE)
species_list[species_list == "x"] <- NA
species_list <- species_list[order(species_list$V2), ]

species_names <- read.table(file = "data/species_names.txt", 
                            header = FALSE,
                            sep = "\t")

species_list_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/SpeciesIDs.txt",
                              header = FALSE, 
                              sep = " ")
species_list_OF <- species_list_OF[order(species_list_OF$V1), ]
species_list_OF$species <-  gsub(pattern = ".fa",
                          replacement = "",
                          species_list_OF$V2)
species_list_OF$species <-  gsub(pattern = "-",
                          replacement = ". ",
                          species_list_OF$species)

species_list_OF[[species]] <- sapply(species_list_OF[[species]], function(x) {
      paste0(toupper(substr(x, 1, 1)), substr(x, 2, nchar(x)))
  })


replace_values <- function(X) {
    # Loop through each entry in the first column of X
    for (i in 1:nrow(X)) {
        # Find the row in Y where the first column matches
        matching_row <- which(species_names$V1 == X$V1[i] | species_names$V2 == X$V1[i])
        
        # Check if a match is found
        if (length(matching_row) == 1) {
          # Replace the entry in X with the value from the second column of Y
          X$V1[i] <- species_names$V4[matching_row]
        }
    }
    # Replace column names
    names(X)[names(X) == "V1"] <- "species"
    names(X)[names(X) == "V4"] <- "pident"
    names(X)[names(X) == "V5"] <- "length"
    names(X)[names(X) == "V6"] <- "mismatch"
    names(X)[names(X) == "V7"] <- "gapopen"
    names(X)[names(X) == "V8"] <- "qstart"
    names(X)[names(X) == "V9"] <- "qend"
    names(X)[names(X) == "V10"] <- "sstart"
    names(X)[names(X) == "V11"] <- "send"
    names(X)[names(X) == "V12"] <- "evalue"
    names(X)[names(X) == "V13"] <- "bitscore"
    X[X == "x"] <- NA
    return(X)
}

replace_col_names_OF <- function(dataset, V1, V2) {
    names(dataset)[names(dataset) == "V1"] <- V1
    names(dataset)[names(dataset) == "V2"] <- V2
    names(dataset)[names(dataset) == "V3"] <- "pident"
    names(dataset)[names(dataset) == "V4"] <- "length"
    names(dataset)[names(dataset) == "V5"] <- "mismatch"
    names(dataset)[names(dataset) == "V6"] <- "gapopen"
    names(dataset)[names(dataset) == "V7"] <- "qstart"
    names(dataset)[names(dataset) == "V8"] <- "qend"
    names(dataset)[names(dataset) == "V9"] <- "sstart"
    names(dataset)[names(dataset) == "V10"] <- "send"
    names(dataset)[names(dataset) == "V11"] <- "evalue"
    names(dataset)[names(dataset) == "V12"] <- "bitscore"
    return(dataset)
}

## Create table with max bitscore for each gene in each species
subset_max_bitscore <- function(data_frame) {
  data_frame %>%
    group_by(species) %>%
    arrange(desc(bitscore)) %>%
    slice_head(n = 1) %>%
    ungroup()
}

## Add right species name to OF tables
add_species_name <- funcion(data_frame) {
  
}

```

3. Load percentage identity data from blastp search:

Does the same for every gene: Loads the blastp results for the human against insect blast and calls the function replace_values on the data. After that, the correct column names are set. The same is done for the blast results for insect against human. The two datasets are combined into one and an additional column with the gene name is added.

```{r , include = FALSE}

## BBS1
bbs1_data_human <- read.table(file = "data/human_vs_insect/NP_078925.3.txt",
                   header = FALSE)
bbs1_data_human <- replace_values(bbs1_data_human)
names(bbs1_data_human)[names(bbs1_data_human) == "V2"] <- "human_ID"
names(bbs1_data_human)[names(bbs1_data_human) == "V3"] <- "insect_ID"

bbs1_data_insect <- read.table(file = "data/insect_vs_human/unranked/NP_078925.3_unranked.txt",
                               header = FALSE)
bbs1_data_insect <- replace_values(bbs1_data_insect)
names(bbs1_data_insect)[names(bbs1_data_insect) == "V3"] <- "human_ID"
names(bbs1_data_insect)[names(bbs1_data_insect) == "V2"] <- "insect_ID"

bbs1_data <- left_join(bbs1_data_human, bbs1_data_insect, by=c("human_ID", "species"))
bbs1_data$locus <-  "BBS1"

## BBS2
bbs2_filepaths_human <- c("data/human_vs_insect/NP_001364385.1.txt", 
                   "data/human_vs_insect/NP_114091.4.txt")
bbs2_data_human <- ldply(bbs2_filepaths_human, read.table, header = FALSE)
bbs2_data_human <- replace_values(bbs2_data_human)
names(bbs2_data_human)[names(bbs2_data_human) == "V2"] <- "human_ID"
names(bbs2_data_human)[names(bbs2_data_human) == "V3"] <- "insect_ID"
bbs2_data_human <- subset_max_bitscore(bbs2_data_human)

bbs2_filepaths_insect <- c("data/insect_vs_human/unranked/NP_001364385.1_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_114091.4_unranked.txt")
bbs2_data_insect <- ldply(bbs2_filepaths_insect, read.table, header = FALSE)
bbs2_data_insect <- replace_values(bbs2_data_insect)
names(bbs2_data_insect)[names(bbs2_data_insect) == "V3"] <- "human_ID"
names(bbs2_data_insect)[names(bbs2_data_insect) == "V2"] <- "insect_ID"

bbs2_data <- left_join(bbs2_data_human, bbs2_data_insect, by=c("human_ID", "species"))
bbs2_data$locus <-  "BBS2"

## BBS4
bbs4_filepaths_human <- c("data/human_vs_insect/NP_149017.2.txt", 
                   "data/human_vs_insect/NP_001307594.1.txt",
                   "data/human_vs_insect/NP_001239607.1.txt")
bbs4_data_human <- ldply(bbs4_filepaths_human, read.table, header = FALSE)
bbs4_data_human <- replace_values(bbs4_data_human)
names(bbs4_data_human)[names(bbs4_data_human) == "V2"] <- "human_ID"
names(bbs4_data_human)[names(bbs4_data_human) == "V3"] <- "insect_ID"
bbs4_data_human <- subset_max_bitscore(bbs4_data_human)

bbs4_filepaths_insect <- c("data/insect_vs_human/unranked/NP_149017.2_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_001307594.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001239607.1_unranked.txt")
bbs4_data_insect <- ldply(bbs4_filepaths_insect, read.table, header = FALSE)
bbs4_data_insect <- replace_values(bbs4_data_insect)
names(bbs4_data_insect)[names(bbs4_data_insect) == "V3"] <- "human_ID"
names(bbs4_data_insect)[names(bbs4_data_insect) == "V2"] <- "insect_ID"

bbs4_data <- left_join(bbs4_data_human, bbs4_data_insect, by=c("human_ID", "species"))
bbs4_data$locus <-  "BBS4"


## BBS5
bbs5_data_human <- read.table(file = "data/human_vs_insect/NP_689597.1.txt",
                   header = FALSE)
bbs5_data_human <- replace_values(bbs5_data_human)
names(bbs5_data_human)[names(bbs5_data_human) == "V2"] <- "human_ID"
names(bbs5_data_human)[names(bbs5_data_human) == "V3"] <- "insect_ID"
bbs5_data_human <- subset_max_bitscore(bbs5_data_human)

bbs5_data_insect <- read.table(file = "data/insect_vs_human/unranked/NP_689597.1_unranked.txt",
                               header = FALSE)
bbs5_data_insect <- replace_values(bbs5_data_insect)
names(bbs5_data_insect)[names(bbs5_data_insect) == "V3"] <- "human_ID"
names(bbs5_data_insect)[names(bbs5_data_insect) == "V2"] <- "insect_ID"

bbs5_data <- left_join(bbs5_data_human, bbs5_data_insect, by=c("human_ID", "species"))
bbs5_data$locus <-  "BBS5"


## BBS7
bbs7_filepaths_human <- c("data/human_vs_insect/NP_060660.2.txt", 
                   "data/human_vs_insect/NP_789794.1.txt")
bbs7_data_human <- ldply(bbs7_filepaths_human, read.table, header = FALSE)
bbs7_data_human <- replace_values(bbs7_data_human)
names(bbs7_data_human)[names(bbs7_data_human) == "V2"] <- "human_ID"
names(bbs7_data_human)[names(bbs7_data_human) == "V3"] <- "insect_ID"
bbs7_data_human <- subset_max_bitscore(bbs7_data_human)

bbs7_filepaths_insect <- c("data/insect_vs_human/unranked/NP_060660.2_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_789794.1_unranked.txt")
bbs7_data_insect <- ldply(bbs7_filepaths_insect, read.table, header = FALSE)
bbs7_data_insect <- replace_values(bbs7_data_insect)
names(bbs7_data_insect)[names(bbs7_data_insect) == "V3"] <- "human_ID"
names(bbs7_data_insect)[names(bbs7_data_insect) == "V2"] <- "insect_ID"

bbs7_data <- left_join(bbs7_data_human, bbs7_data_insect, by=c("human_ID", "species"))
bbs7_data$locus <-  "BBS7"


## BBS8
bbs8_filepaths_human <- c("data/human_vs_insect/NP_653197.2.txt", 
                   "data/human_vs_insect/NP_938051.1.txt",
                   "data/human_vs_insect/NP_938052.1.txt",
                   "data/human_vs_insect/NP_001275710.1.txt",
                   "data/human_vs_insect/NP_001275711.1.txt",
                   "data/human_vs_insect/NP_001275712.1.txt",
                   "data/human_vs_insect/NP_001353464.1.txt",
                   "data/human_vs_insect/NP_001353465.1.txt")
bbs8_data_human <- ldply(bbs8_filepaths_human, read.table, header = FALSE)
bbs8_data_human <- replace_values(bbs8_data_human)
names(bbs8_data_human)[names(bbs8_data_human) == "V2"] <- "human_ID"
names(bbs8_data_human)[names(bbs8_data_human) == "V3"] <- "insect_ID"
bbs8_data_human <- subset_max_bitscore(bbs8_data_human)

bbs8_filepaths_insect <- c("data/insect_vs_human/unranked/NP_653197.2_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_938051.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_938052.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001275710.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001275711.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001275712.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001353464.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001353465.1_unranked.txt")
bbs8_data_insect <- ldply(bbs8_filepaths_insect, read.table, header = FALSE)
bbs8_data_insect <- replace_values(bbs8_data_insect)
names(bbs8_data_insect)[names(bbs8_data_insect) == "V3"] <- "human_ID"
names(bbs8_data_insect)[names(bbs8_data_insect) == "V2"] <- "insect_ID"

bbs8_data <- left_join(bbs8_data_human, bbs8_data_insect, by=c("human_ID", "species"))
bbs8_data$locus <-  "BBS8"

## BBS9
bbs9_filepaths_human <- c("data/human_vs_insect/NP_055266.2.txt", 
                   "data/human_vs_insect/NP_940820.1.txt",
                   "data/human_vs_insect/NP_001028776.1.txt",
                   "data/human_vs_insect/NP_001028777.1.txt",
                   "data/human_vs_insect/NP_001334965.1.txt",
                   "data/human_vs_insect/NP_001334966.1.txt",
                   "data/human_vs_insect/NP_001334967.1.txt",
                   "data/human_vs_insect/NP_001334968.1.txt",
                   "data/human_vs_insect/NP_001334969.1.txt",
                   "data/human_vs_insect/NP_001334970.1.txt",
                   "data/human_vs_insect/NP_001334971.1.txt",
                   "data/human_vs_insect/NP_001334972.1.txt",
                   "data/human_vs_insect/NP_001334973.1.txt",
                   "data/human_vs_insect/NP_001334974.1.txt",
                   "data/human_vs_insect/NP_001334975.1.txt",
                   "data/human_vs_insect/NP_001349608.1.txt")
bbs9_data_human <- ldply(bbs9_filepaths_human, read.table, header = FALSE)
bbs9_data_human <- replace_values(bbs9_data_human)
names(bbs9_data_human)[names(bbs9_data_human) == "V2"] <- "human_ID"
names(bbs9_data_human)[names(bbs9_data_human) == "V3"] <- "insect_ID"
bbs9_data_human <- subset_max_bitscore(bbs9_data_human)

bbs9_filepaths_insect <- c("data/insect_vs_human/unranked/NP_055266.2_unranked.txt",
                           "data/insect_vs_human/unranked/NP_940820.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001028776.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001028777.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334965.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334966.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334967.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334968.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334969.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334970.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334971.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334972.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334973.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334974.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001334975.1_unranked.txt",
                           "data/insect_vs_human/unranked/NP_001349608.1_unranked.txt")
bbs9_data_insect <- ldply(bbs9_filepaths_insect, read.table, header = FALSE)
bbs9_data_insect <- replace_values(bbs9_data_insect)
names(bbs9_data_insect)[names(bbs9_data_insect) == "V3"] <- "human_ID"
names(bbs9_data_insect)[names(bbs9_data_insect) == "V2"] <- "insect_ID"

bbs9_data <- left_join(bbs9_data_human, bbs9_data_insect, by=c("human_ID", "species"))
bbs9_data$locus <-  "BBS9"

## BBS10
bbs10_data_human <- read.table(file = "data/human_vs_insect/NP_078961.3.txt",
                   header = FALSE)
bbs10_data_human <- replace_values(bbs10_data_human)
names(bbs10_data_human)[names(bbs10_data_human) == "V2"] <- "human_ID"
names(bbs10_data_human)[names(bbs10_data_human) == "V3"] <- "insect_ID"
bbs10_data_human <- subset_max_bitscore(bbs10_data_human)
#
bbs10_data_insect <- read.table(file = "data/insect_vs_human/unranked/NP_078961.3_unranked.txt",
                               header = FALSE)
bbs10_data_insect <- replace_values(bbs10_data_insect)
names(bbs10_data_insect)[names(bbs10_data_insect) == "V3"] <- "human_ID"
names(bbs10_data_insect)[names(bbs10_data_insect) == "V2"] <- "insect_ID"

bbs10_data <- left_join(bbs10_data_human, bbs10_data_insect, by=c("human_ID", "species"))
bbs10_data$locus <-  "BBS10"

## BBS12
bbs12_filepaths_human <- c("data/human_vs_insect/NP_001171478.1.txt", 
                   "data/human_vs_insect/NP_689831.2.txt")
bbs12_data_human <- ldply(bbs12_filepaths_human, read.table, header = FALSE)
bbs12_data_human <- replace_values(bbs12_data_human)
names(bbs12_data_human)[names(bbs12_data_human) == "V2"] <- "human_ID"
names(bbs12_data_human)[names(bbs12_data_human) == "V3"] <- "insect_ID"
bbs12_data_human <- subset_max_bitscore(bbs12_data_human)

bbs12_filepaths_insect <- c("data/insect_vs_human/unranked/NP_001171478.1_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_689831.2_unranked.txt")
bbs12_data_insect <- ldply(bbs12_filepaths_insect, read.table, header = FALSE)
bbs12_data_insect <- replace_values(bbs12_data_insect)
names(bbs12_data_insect)[names(bbs12_data_insect) == "V3"] <- "human_ID"
names(bbs12_data_insect)[names(bbs12_data_insect) == "V2"] <- "insect_ID"

bbs12_data <- left_join(bbs12_data_human, bbs12_data_insect, by=c("human_ID", "species"))
bbs12_data$locus <-  "BBS12"

## BBS18
bbs18_filepaths_human <- c("data/human_vs_insect/NP_001182234.1.txt",
                   "data/human_vs_insect/NP_001182235.1.txt",
                   "data/human_vs_insect/NP_001182236.1.txt",
                   "data/human_vs_insect/NP_001230712.1.txt")
bbs18_data_human <- ldply(bbs18_filepaths_human, read.table, header = FALSE)
bbs18_data_human <- replace_values(bbs18_data_human)
names(bbs18_data_human)[names(bbs18_data_human) == "V2"] <- "human_ID"
names(bbs18_data_human)[names(bbs18_data_human) == "V3"] <- "insect_ID"
bbs18_data_human <- subset_max_bitscore(bbs18_data_human)

bbs18_filepaths_insect <- c("data/insect_vs_human/unranked/NP_001182234.1_unranked.txt", 
                   "data/insect_vs_human/unranked/NP_001182235.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001182236.1_unranked.txt",
                   "data/insect_vs_human/unranked/NP_001230712.1_unranked.txt")
bbs18_data_insect <- ldply(bbs18_filepaths_insect, read.table, header = FALSE)
bbs18_data_insect <- replace_values(bbs18_data_insect)
names(bbs18_data_insect)[names(bbs18_data_insect) == "V3"] <- "human_ID"
names(bbs18_data_insect)[names(bbs18_data_insect) == "V2"] <- "insect_ID"

bbs18_data <- left_join(bbs18_data_human, bbs18_data_insect, by=c("human_ID", "species"))
bbs18_data$locus <-  "BBS18"



## All tables generated for each gene are combined into one big table.
combined_data_BLAST <-  rbind(bbs1_data,
                              bbs2_data,
                              bbs4_data,
                              bbs5_data,
                              bbs7_data,
                              bbs8_data,
                              bbs9_data,
                              bbs10_data,
                              bbs12_data,
                              bbs18_data)

#combined_data_BLAST$origin <- "BLASTP"
## A subset of the data is created with only the columns needed for the plots
data_sub_BLAST <- combined_data_BLAST %>%
  select(human_ID,
         insect_ID.x,
         pident.x,
         pident.y,
         evalue.x,
         bitscore.x,
         bitscore.y,
         locus,
         species)


#data_sub_BLAST$species <-  str_to_title(data_sub_BLAST$species)
data_sub_BLAST$pident.x <- as.numeric(data_sub_BLAST$pident.x)
data_sub_BLAST$pident.y <- as.numeric(data_sub_BLAST$pident.y)
data_sub_BLAST$pident.x[is.na(data_sub_BLAST$pident.x)] <- 0
data_sub_BLAST$pident.y[is.na(data_sub_BLAST$pident.y)] <- 0

data_sub_BLAST <- subset(data_sub_BLAST,
                   species != "h_sapiens.fa")
data_sub_BLAST <- subset(data_sub_BLAST,
                   species != "m_musculus.fa")

# Separate the numeric and non-numeric parts
data_sub_BLAST <- data_sub_BLAST %>%
  mutate(
    number = as.numeric(str_extract(locus, "\\d+")),
    locus = factor(locus, levels = unique(locus[order(number)]))
  )

## Update levels for plots:
data_sub_BLAST$species <- factor(data_sub_BLAST$species,
                         levels = unique(data_sub_BLAST$species))

print("Done!")
```

4. Load percentage identity data from OrthoFinder search:

```{r, include = FALSE}
## Read in species list:
species_list_orthofinder <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/SpeciesIDs.txt",
                           header = FALSE, sep = "\t")

species_list_ordered <- species_list_orthofinder[order(species_list_orthofinder$V1), ]

## BBS1
bbs1_data_human_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12387.txt",
                   header = FALSE)
bbs1_data_human_OF <- replace_col_names_OF(bbs1_data_human_OF, "human_ID", "insect_ID")
bbs1_data_human_OF$species <- species_list_ordered$V2

bbs1_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12387_rep.txt",
                   header = FALSE)
bbs1_data_insect_OF <- replace_col_names_OF(bbs1_data_insect_OF, "insect_ID", "human_ID")
bbs1_data_insect_OF$species <- species_list_ordered$V2

bbs1_data_OF <- left_join(bbs1_data_human_OF, bbs1_data_insect_OF, by=c("human_ID", "species"))
bbs1_data_OF$locus <- "BBS1"

## BBS2
bbs2_data_human_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_17593.txt",
                   header = FALSE)
bbs2_data_human_OF <- replace_col_names_OF(bbs2_data_human_OF, "human_ID", "insect_ID")
bbs2_data_human_OF$species <- species_list_ordered$V2[-8]

bbs2_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_17593_rep.txt",
                   header = FALSE)
bbs2_data_insect_OF <- replace_col_names_OF(bbs2_data_insect_OF, "insect_ID", "human_ID")
bbs2_data_insect_OF$species <- species_list_ordered$V2[-8]

bbs2_data_OF <- left_join(bbs2_data_human_OF, bbs2_data_insect_OF, by=c("human_ID", "species"))
bbs2_data_OF$locus <- "BBS2"

## BBS4
bbs4_data_human_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_15727.txt",
                   header = FALSE)
bbs4_data_human_OF <- replace_col_names_OF(bbs4_data_human_OF, "human_ID", "insect_ID")
bbs4_data_human_OF$species <- species_list_ordered$V2

bbs4_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_15727_rep.txt",
                   header = FALSE)
bbs4_data_insect_OF <- replace_col_names_OF(bbs4_data_insect_OF, "insect_ID", "human_ID")
bbs4_data_insect_OF$species <- species_list_ordered$V2

bbs4_data_OF <- left_join(bbs4_data_human_OF, bbs4_data_insect_OF, by=c("human_ID", "species"))
bbs4_data_OF$locus <- "BBS4"

## BBS5
bbs5_data_human_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_15529.txt",
                   header = FALSE)
bbs5_data_human_OF <- replace_col_names_OF(bbs5_data_human_OF, "human_ID", "insect_ID")
bbs5_data_human_OF$species <- species_list_ordered$V2

bbs5_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_15529_rep.txt",
                   header = FALSE)
bbs5_data_insect_OF <- replace_col_names_OF(bbs5_data_insect_OF, "insect_ID", "human_ID")
bbs5_data_insect_OF$species <- species_list_ordered$V2

bbs5_data_OF <- left_join(bbs5_data_human_OF, bbs5_data_insect_OF, by=c("human_ID", "species"))
bbs5_data_OF$locus <- "BBS5"

## BBS6
bbs6_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_4999.txt",
                                  header = FALSE)
bbs6_data_human_OF <- replace_col_names_OF(bbs6_data_human_OF, "human_ID", "insect_ID")

bbs6_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_4999_rep.txt",
                   header = FALSE)
bbs6_data_insect_OF <- replace_col_names_OF(bbs6_data_insect_OF, "insect_ID", "human_ID")

bbs6_data_OF <- left_join(bbs6_data_human_OF, bbs6_data_insect_OF, by=c("human_ID", "species"))
bbs6_data_OF$locus <- "BBS6"

## BBS7
bbs7_data_human_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_10312.txt",
                   header = FALSE)
bbs7_data_human_OF <- replace_col_names_OF(bbs7_data_human_OF, "human_ID", "insect_ID")
bbs7_data_human_OF$species <- species_list_ordered$V2[-8]

bbs7_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_10312_rep.txt",
                   header = FALSE)
bbs7_data_insect_OF <- replace_col_names_OF(bbs7_data_insect_OF, "insect_ID", "human_ID")
bbs7_data_insect_OF$species <- species_list_ordered$V2[-8]

bbs7_data_OF <- left_join(bbs7_data_human_OF, bbs7_data_insect_OF, by=c("human_ID", "species"))
bbs7_data_OF$locus <- "BBS7"

## BBS8
bbs8_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_6195.txt",
                                  header = FALSE)
bbs8_data_human_OF <- replace_col_names_OF(bbs8_data_human_OF, "human_ID", "insect_ID")

bbs8_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_6195_rep.txt",
                   header = FALSE)
bbs8_data_insect_OF <- replace_col_names_OF(bbs8_data_insect_OF, "insect_ID", "human_ID")

bbs8_data_OF <- left_join(bbs8_data_human_OF, bbs8_data_insect_OF, by=c("human_ID", "species"))
bbs8_data_OF$locus <- "BBS8"

## BBS9
bbs9_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_5677.txt",
                                  header = FALSE)
bbs9_data_human_OF <- replace_col_names_OF(bbs9_data_human_OF, "human_ID", "insect_ID")

bbs9_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_5677_rep.txt",
                   header = FALSE)
bbs9_data_insect_OF <- replace_col_names_OF(bbs9_data_insect_OF, "insect_ID", "human_ID")

bbs9_data_OF <- left_join(bbs9_data_human_OF, bbs9_data_insect_OF, by=c("human_ID", "species"))
bbs9_data_OF$locus <- "BBS9"

## BBS10
bbs10_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12045.txt",
                                  header = FALSE)
bbs10_data_human_OF <- replace_col_names_OF(bbs10_data_human_OF, "human_ID", "insect_ID")

bbs10_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12045_rep.txt",
                   header = FALSE)
bbs10_data_insect_OF <- replace_col_names_OF(bbs10_data_insect_OF, "insect_ID", "human_ID")

bbs10_data_OF <- left_join(bbs10_data_human_OF, bbs10_data_insect_OF, by=c("human_ID", "species"))
bbs10_data_OF$locus <- "BBS10"

## BBS11
bbs11_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_11753.txt",
                                  header = FALSE)
bbs11_data_human_OF <- replace_col_names_OF(bbs11_data_human_OF, "human_ID", "insect_ID")

bbs11_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_11753_rep.txt",
                   header = FALSE)
bbs11_data_insect_OF <- replace_col_names_OF(bbs11_data_insect_OF, "insect_ID", "human_ID")

bbs11_data_OF <- left_join(bbs11_data_human_OF, bbs11_data_insect_OF, by=c("human_ID", "species"))
bbs11_data_OF$locus <- "BBS11"

## BBS12
bbs12_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12454.txt",
                                  header = FALSE)
bbs12_data_human_OF <- replace_col_names_OF(bbs12_data_human_OF, "human_ID", "insect_ID")

bbs12_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_12454_rep.txt",
                   header = FALSE)
bbs12_data_insect_OF <- replace_col_names_OF(bbs12_data_insect_OF, "insect_ID", "human_ID")

bbs12_data_OF <- left_join(bbs12_data_human_OF, bbs12_data_insect_OF, by=c("human_ID", "species"))
bbs12_data_OF$locus <- "BBS12"

## BBS18
bbs18_data_human_OF <- read.ftable(file ="data/OrthoFinder/OrthoFinder/with1000ofANTS/10_13408.txt",
                                  header = FALSE)
bbs18_data_human_OF <- replace_col_names_OF(bbs18_data_human_OF, "human_ID", "insect_ID")

bbs18_data_insect_OF <- read.table(file = "data/OrthoFinder/OrthoFinder/with1000ofANTS/10_13408_rep.txt",
                   header = FALSE)
bbs18_data_insect_OF <- replace_col_names_OF(bbs18_data_insect_OF, "insect_ID", "human_ID")

bbs18_data_OF <- left_join(bbs18_data_human_OF, bbs18_data_insect_OF, by=c("human_ID", "species"))
bbs18_data_OF$locus <- "BBS18"




## Combine:
combined_data_OF <-  rbind(bbs1_data_OF,
                        bbs2_data_OF,
                        bbs4_data_OF,
                        bbs5_data_OF,
                        bbs7_data_OF,
                        bbs8_data_OF,
                        bbs9_data_OF,
                        bbs10_data_OF,
                        bbs11_data_OF,
                        bbs18_data_OF)

data_sub_OF <- combined_data_OF %>%
  select(human_ID,
         insect_ID.x,
         pident.x,
         pident.y,
         evalue.x,
         bitscore.x,
         bitscore.y,
         locus,
         species,
         origin)


#data_sub_OF$species <-  str_to_title(data_sub_OF$species)
data_sub_OF$pident.x <- as.numeric(data_sub_OF$pident.x)
data_sub_OF$pident.y <- as.numeric(data_sub_OF$pident.y)
data_sub_OF$pident.x[is.na(data_sub_OF$pident.x)] <- 0
data_sub_OF$pident.y[is.na(data_sub_OF$pident.y)] <- 0

data_sub_OF <- subset(data_sub_OF,
                   species != "h_sapiens.fa")
data_sub_OF <- subset(data_sub_OF,
                   species != "m_musculus.fa")

# Separate the numeric and non-numeric parts
data_sub_OF <- data_sub_OF %>%
  mutate(
    number = as.numeric(str_extract(locus, "\\d+")),
    locus = factor(locus, levels = unique(locus[order(number)]))
  )

## Update levels for plots:
data_sub_OF$species <- factor(data_sub_OF$species,
                         levels = unique(data_sub_OF$species))

```

6. Combine BLASTP data with OF data for plotting

```{r, include = FALSE}
## Add new column with origin to both datasets
combined_data_BLAST$origin <- "BLASTP"
combined_data_OF$origin <- "OF"

combined_data <- rbind(combined_data_BLAST,
                       combined_data_OF)

```


7. Plot data

```{r, echo = FALSE}

## Create variable with colors
color_ID <- c("#FF0000", "#008000", "#0000FF", "#FFA500", "#800080",
              "#00FFFF", "#FF00FF", "#00FF00", "#808000", "#ffff00","#800000")


## function for plot by gene:
seq_sim_plot <- function(data_sub, point_shape){
  ggplot(data = data_sub,
       aes(x = pident.x,
           y = pident.y)) +
  xlab(expression(paste(italic("H. sapiens"), " vs Insect - Percentage ID [%]"))) +
  ylab(expression(paste("Insect vs ", italic("H. sapiens"), " - Percentage ID [%]"))) +
  geom_point(aes(color = species),
             alpha = 0.8,
             shape = point_shape,
             size = 5
             ) +
  scale_color_manual("Species", values = color_ID) +
  theme_bw() +
  theme(axis.title = element_text(face = "bold",
                                  size = 12),
        legend.text = element_text(face = "italic",
                                   size = 10),
        legend.position = c(1, 0),
                     legend.justification = c(1, 0.1),
        legend.direction = "horizontal"
        ) +
  guides(color = guide_legend(title.position = "top")) +
  facet_wrap(~locus,
             nrow = 3,
             ncol = 4)
}

## Plot results for BLASTP
(seq_sim_plot_BLAST <- seq_sim_plot(data_sub_BLAST, 19))
#(seq_sim_plot_OF <- seq_sim_plot(data_sub_OF, 19))

(bbs_boxplot_BLAST <- ggplot(data = subset(data_sub_BLAST,
                                    pident.x < 60),
       aes(x = locus,
           y = pident.x)) +
  labs(y = "*H. sapiens* vs Insect -<br>Percentage ID [%]") +
  xlab("Locus") +
  geom_boxplot() +
  theme_bw() +
  theme(axis.title = element_text(size = 12)) +
  theme(axis.title.y = ggtext::element_markdown()) +
  stat_compare_means())

## Create empty plot
#empty_plot <- ggplot() + theme_void()

(combined_plot <- ggarrange(seq_sim_plot_BLAST, empty_plot,
          bbs_boxplot_BLAST,
          ncol = 1,
          nrow = 3,
          heights = c(2,0.1,1),
          labels = c("A","B", "")))

## b) plot by species:
seq_sim_plot2 <- ggplot(data = data_sub,
       aes(x = pident.x,
           y = pident.y)) +
  xlab("Human vs Insect (top match) - Percentage ID [%]") +
  ylab("Insect vs Human (unranked)- Percentage ID [%]") +
  geom_point(aes(fill = locus), 
             alpha = 0.8,
       colour = "black",
       pch = 21,
       size = 5) +
  scale_fill_manual(values = c("#FF0000", "#008000", "#0000FF", "#FFA500", "#800080", 
                                "#00FFFF", "#FF00FF", "#00FF00", "#808000", "#ffff00", 
                                "#800000")) +
  xlim(c(0,50)) +
  ylim(c(0,50)) +
  theme_bw() +
  theme(axis.title = element_text(face = "bold",
                                  size = 12)) +
  facet_wrap(~species)

## Italicise grid:
seq_sim_plot2 <- seq_sim_plot2 +
  theme(strip.text = element_text(face = "italic"))

```

7. Save data 

```{r, include = FALSE}
## Save image:
if (!dir.exists("results")) {dir.create("results")} 

ggsave(filename = "results/multipanel_scatterplot_by_gene.png",
       plot = seq_sim_plot,
       height = 8,
       width = 12)

ggsave(filename = "results/multipanel_scatterplot_by_gene_new.pdf",
       plot = combined_plot,
       height = 13,
       width = 11)

ggsave(filename = "results/multipanel_scatter_boxplot_by_gene.png",
       plot = combined_plot,
       height = 10,
       width = 17)

ggsave(filename = "results/multipanel_scatterplot_by_species.pdf",
       plot = seq_sim_plot2,
       height = 8,
       width = 12)

## Save data
write.table(data_sub, file = "data/bbs_results_plot.txt", row.names = FALSE, col.names = TRUE, sep = "\t")
```

